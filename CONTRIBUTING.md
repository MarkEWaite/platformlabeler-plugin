Contributing to the Platform Labeler Plugin
==============================

Plugin source code is hosted on [GitHub](https://github.com/jenkinsci/platformlabeler-plugin).
New feature proposals and bug fix proposals should be submitted as
[GitHub pull requests](https://help.github.com/articles/creating-a-pull-request).
Your pull request will be evaluated by the [Jenkins job](https://ci.jenkins.io/job/Plugins/job/platformlabeler-plugin/).

Before submitting your change, please assure that you've added tests
which verify your change.

## Code Coverage

[JaCoCo code coverage](https://www.jacoco.org/jacoco/) reporting is available as a maven target and can be displayed by the [Jenkins warnings next generation plugin](https://plugins.jenkins.io/warnings-ng/).
Please try to improve code coverage with tests when you submit.
* `mvn -P enable-jacoco clean install jacoco:report` to report code coverage with JaCoCo.

[OpenClover code coverage](https://openclover.org/) reporting is available as a maven target and can be displayed by the [Jenkins clover plugin](https://plugins.jenkins.io/clover/).
* `mvn clover:setup clover:instrument test clover:clover` to report code coverage with OpenClover.

Please don't introduce new spotbugs output.
* `mvn spotbugs:check` to analyze project using [Spotbugs](https://spotbugs.github.io)
* `mvn spotbugs:gui` to review report using GUI

## Mutation Testing

PIT mutation testing is available as a maven target.

* `mvn org.pitest:pitest-maven:mutationCoverage` to perform mutation testing and generate a report

## Code Formatting

Code formatting in the Platform Labeler plugin is maintained by the git code format maven plugin.
The pom file format is maintained by the tidy plugin.
Before submitting a pull request, confirm the formatting is correct with:

* `mvn compile`

If the formatting is not correct, the build will fail.  Correct the formatting with:

* `mvn tidy:pom git-code-format:format-code -Dgcf.globPattern=**/*`

## Pre-commit Hooks

File content is consistency checked at commit time by the [pre-commit framework](https://pre-commit.com/).
Refer to [.pre-commit-config.yaml](.pre-commit-config.yaml) for the current checks.

To install the pre-commit framework into this repository on your computer, use the commands:

```
$ pip install --user pre-commit
$ pre-commit install
```

To upgrade the pre-commit framework into this repository on your computer, use the commands:

```
$ pip install --user --upgrade pre-commit
$ pre-commit install
```

Pre-commit checks are run on modified files during `git commit`.
Files which fail pre-commit checks will abort the `git commit`.

Run pre-commit checks on all files:
```
$ pre-commit run --all-files
```

## Maintaining automated tests

Automated tests are run as part of the `verify` phase.
Automated tests in the `continuous-integration` profile are run with multiple Java virtual machines, depending on the number of available processor cores.
Run automated tests with multiple Java virtual machines in a development with the command:

```
$ mvn clean -DforkCount=1C verify
```

Test data for automated tests is extracted from Docker images defined in subdirectories of `src/test/resources/org/jvnet/hudson/plugins/platformlabeler`.
The subdirectory name is used as an index into a map that defines the expected value of the operating system name.

The contents of `/etc/os-release` and the output of `lsb_release -a` are stored in the same subdirectory as the defining `Dockerfile`.
The data files are generated by the shell scripts in the `src/test/resources/org/jvnet/hudson/plugins/platformlabeler` directory.
A maintainer runs those shell scripts periodically and decides which data files should be updated with the latest information.

The Dockerfile base tags are tracked by dependabot in hopes that Docker image updates will result in automated pull requests for the Docker image tags.

## Security Issues

Follow the [Jenkins project vulnerability reporting instructions](https://jenkins.io/security/reporting/) to report vulnerabilities.
